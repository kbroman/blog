<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.56.3" />


<title>EOF within quoted string - the stupidest thing...</title>
<meta property="og:title" content="EOF within quoted string - the stupidest thing...">




  








<link href='//cdn.bootcss.com/highlight.js/9.10.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="../../../../blog/css/fonts.css" media="all">
<link rel="stylesheet" href="../../../../blog/css/main.css" media="all">

<link rel="stylesheet" href="../../../../blog/css/custom.css">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://kbroman.org/blog/" class="nav-logo">
    <img src="https://kbroman.org/blog/images/karl.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <a href="https://kbroman.org/blog/" class="nav-title">the stupidest thing...</a>

  <ul class="nav-links">
    
    <li><a href="https://kbroman.org/blog/about">
            <img alt="about" src="../../../../images/about_logo.png" class="nav-link"/>
            </a></li>
    
    <li><a href="https://github.com/kbroman">
            <img alt="github" src="../../../../images/github_logo.png" class="nav-link"/>
            </a></li>
    
    <li><a href="https://twitter.com/kwbroman">
            <img alt="twitter" src="../../../../images/twitter_logo.png" class="nav-link"/>
            </a></li>
    
    <li><a href="https://kbroman.org">
            <img alt="web" src="../../../../images/web_logo.png" class="nav-link"/>
            </a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">4 min read</span>
    

    <h1 class="article-title">EOF within quoted string</h1>

    
    <span class="article-date">2017-08-08</span>
    

    <div class="article-content">
      


<p>So I was trying to parse
<a href="http://www.informatics.jax.org/downloads/mgigff/MGI.20170803.gff3.gz">this gff file</a>
from <a href="http://www.informatics.jax.org/">MGI</a>, with mouse gene
annotations. And, well, I’m an idiot. But in a way that is potentially
instructive.</p>
<p>The documentation for the file is a
<a href="http://www.informatics.jax.org/downloads/mgigff/MGI_GFF_Spec.docx">docx file</a>
(not really a recommended format for such metadata), but it seems
rather simple, really: tab delimited, with 9 columns, the ninth column
being a bunch of pasted attributes that needs to be further parsed,
but we’ll skip over that detail.</p>
<p>I’d want to use <code>fread()</code> from the
<a href="https://github.com/Rdatatable/data.table/wiki">data.table package</a>,
but it turns out that the file has a bunch of lines with “<code>###</code>”
interspersed within the data, and I couldn’t see a way to skip over
those in <code>fread()</code>, so I fell back to the usual base R function,
<code>read.table()</code>.</p>
<p>Let’s first download and unzip the file.</p>
<pre class="r"><code># download the file
site &lt;- &quot;http://www.informatics.jax.org/downloads/mgigff&quot;
file &lt;- &quot;MGI.20170803.gff3.gz&quot;
url &lt;- paste0(site, &quot;/&quot;, file)
if(!file.exists(file)) download.file(url, file)

# unzip to a temporary file
file &lt;- sub(&quot;.gz$&quot;, &quot;&quot;, file)
tmpfile &lt;- tempfile()
remove_tmpfile &lt;- FALSE
if(!file.exists(file)) { # need to unzip
    system(paste0(&quot;gunzip -c &quot;, file, &quot;.gz &gt; &quot;, tmpfile))
    remove_tmpfile &lt;- TRUE
    file &lt;- tmpfile
}</code></pre>
<p>Okay, now to read it into R with <code>read.table()</code>.</p>
<pre class="r"><code>tab &lt;- read.table(file, sep=&quot;\t&quot;, header=FALSE, comment.char=&quot;#&quot;,
                  na.strings=&quot;.&quot;, stringsAsFactors=FALSE)</code></pre>
<p>This gives a warning message:</p>
<pre><code>Warning message:
In scan(file = file, what = what, sep = sep, quote = quote, dec = dec,  :
  EOF within quoted string</code></pre>
<p>Hmm. What does that mean? Oh, no matter, let’s move on…</p>
<p>Wait, there are no genes on chromosomes 5, 8, 15, 18, Y, or MT. How
could that be? Something must be wrong with the file. Let’s look at
another file at that site,
<a href="http://www.informatics.jax.org/downloads/mgigff/MGI.20160103.gff3.gz"><code>MGI.20160103.gff3.gz</code></a>.
That one’s missing chromosomes 8 and 13.</p>
<p>So I ask
<a href="https://www.jax.org/research-and-faculty/faculty/research-scientists/daniel-gatti">Dan Gatti</a>:
“Hey, those files are corrupted. Who should I talk to about them?”</p>
<p>And he’s like, “That’d be a disaster, but they look fine to me [parsed with <code>read.delim()</code>].”</p>
<p>So I tried using <code>read.delim()</code> and sure enough, no warning, genes
on all chromosomes, and about twice as many records. Oops.</p>
<div id="read.delim-vs-read.table" class="section level2">
<h2><code>read.delim()</code> vs <code>read.table()</code></h2>
<p>So what’s the difference between <code>read.delim()</code> and <code>read.table()</code>?
Well, <code>read.delim()</code> calls <code>read.table()</code> with a particular set of
default values for the arguments:</p>
<pre><code>&gt; read.delim
function (file, header = TRUE, sep = &quot;\\t&quot;, quote = &quot;\\&quot;&quot;, dec = &quot;.&quot;,
    fill = TRUE, comment.char = &quot;&quot;, ...)
read.table(file = file, header = header, sep = sep, quote = quote,
    dec = dec, fill = fill, comment.char = comment.char, ...)</code></pre>
<p>The key argument here is <code>quote</code>, in that <code>read.table()</code> uses <code>quote=&quot;'\&quot;&quot;</code>
(that is, looking for either single- or double-quotes)
while <code>read.delim()</code> uses <code>quote=&quot;\&quot;&quot;</code> (just looking for double-quotes).</p>
<p>There are no double-quotes in the file, but that ninth column includes some single-quotes, and
so my use of <code>read.table()</code> was mucking everything up.
And presumably there was an odd number of
them, so the end-of-file (EOF) character was inside one of those
quoted strings.</p>
<p>To read the file properly, I should have used <code>quote=&quot;\&quot;&quot;</code>. Even
better, I could use <code>quote=&quot;&quot;</code>, and for that matter also <code>fill=FALSE</code>
(since every line is supposed to contain all nine columns).</p>
<pre class="r"><code>tab &lt;- read.table(file, sep=&quot;\t&quot;, header=FALSE, comment.char=&quot;#&quot;,
                  na.strings=&quot;.&quot;, stringsAsFactors=FALSE,
                  quote=&quot;&quot;, fill=FALSE)</code></pre>
</div>
<div id="lessons" class="section level2">
<h2>Lessons</h2>
<p>There are several lessons here.</p>
<ul>
<li><p>I shouldn’t have ignored the “<code>EOF within quoted string</code>”
warning.</p></li>
<li><p>I should have compared the number of lines I read in with the number
of lines in the input file. If I’d done so, I’d have seen that I had
just about half as many lines as I should’ve, and so I’d clearly
messed something up.</p></li>
<li><p>When I run into a problem like this, it’s more likely that there’s a
problem with my code than that there’s a problem with the file.</p></li>
<li><p>With a file of this sort, I should have used <code>quote=&quot;&quot;</code> and
<code>fill=FALSE</code> in my call to <code>read.table()</code>. I’m not expecting any
quoted fields, and I’m expecting that every line will have exactly nine
columns.</p></li>
<li><p>It’s good to have a friend like Dan.</p></li>
</ul>
</div>

    </div>
  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script>
  
  var disqus_config = function () {
    this.page.url = "https:\/\/kbroman.org\/blog" + location.pathname;
  };
  
  (function() {
   var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var d = document, s = d.createElement('script');
    s.src = '//kbroman-blog.disqus.com/embed.js'; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://creativecommons.org/licenses/by/4.0/legalcode"><img src="https://kbroman.org/blog/images/cc-by.svg" height="28" style="vertical-align:middle;"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.10.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.10.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.10.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="../../../../blog/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

